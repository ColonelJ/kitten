def {x f} dip {
  f apply x
}

def push {
  vec cat
}

def {xs f g} topdown {
  xs down f apply
  xs top g apply
  push
}

def {t x} when {
  t {} x if
}

def {f x} unless {
  {} f x if
}

def {xs f} map {
  { [] }
  {}
  xs fun compose
  f fun {map} compose fun compose
  f fun compose
  {topdown} compose
  xs empty if
}
